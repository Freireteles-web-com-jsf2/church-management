import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('üå± Iniciando seed do banco de dados...');

    // Limpar dados existentes
    await prisma.mensagemMural.deleteMany();
    await prisma.evento.deleteMany();
    await prisma.patrimonio.deleteMany();
    await prisma.lancamentoFinanceiro.deleteMany();
    await prisma.pessoa.deleteMany();
    await prisma.grupo.deleteMany();
    await prisma.permissao.deleteMany();
    await prisma.perfil.deleteMany();

    console.log('üóëÔ∏è  Dados existentes removidos');

    // Criar perfis e permiss√µes
    await createPerfis();
    console.log('üë• Perfis criados');

    // Criar grupos
    const grupos = await createGrupos();
    console.log('üè† Grupos criados');

    // Criar pessoas
    await createPessoas(grupos);
    console.log('üë§ Pessoas criadas');

    // Criar lan√ßamentos financeiros
    await createLancamentosFinanceiros();
    console.log('üí∞ Lan√ßamentos financeiros criados');

    // Criar patrim√¥nio
    await createPatrimonio();
    console.log('üì¶ Patrim√¥nio criado');

    // Criar eventos
    await createEventos();
    console.log('üìÖ Eventos criados');

    // Criar mensagens do mural
    await createMensagensMural();
    console.log('üì¢ Mensagens do mural criadas');

    console.log('‚úÖ Seed conclu√≠do com sucesso!');
}

async function createPerfis() {
    const perfisData = [
        {
            nome: 'Administrador',
            permissoes: {
                create: [
                    { nome: 'gerenciar_usuarios', descricao: 'Gerenciar usu√°rios do sistema' },
                    { nome: 'gerenciar_perfis', descricao: 'Gerenciar perfis e permiss√µes' },
                    { nome: 'acessar_todas_funcionalidades', descricao: 'Acesso total ao sistema' },
                    { nome: 'gerenciar_configuracoes', descricao: 'Gerenciar configura√ß√µes do sistema' },
                ]
            }
        },
        {
            nome: 'Pastor',
            permissoes: {
                create: [
                    { nome: 'gerenciar_membros', descricao: 'Gerenciar membros da igreja' },
                    { nome: 'gerenciar_grupos', descricao: 'Gerenciar grupos e c√©lulas' },
                    { nome: 'visualizar_financeiro', descricao: 'Visualizar relat√≥rios financeiros' },
                    { nome: 'gerenciar_eventos', descricao: 'Gerenciar eventos e agenda' },
                    { nome: 'gerenciar_mural', descricao: 'Gerenciar mural da igreja' },
                ]
            }
        },
        {
            nome: 'L√≠der',
            permissoes: {
                create: [
                    { nome: 'visualizar_membros', descricao: 'Visualizar membros do seu grupo' },
                    { nome: 'gerenciar_seu_grupo', descricao: 'Gerenciar apenas seu grupo' },
                    { nome: 'criar_eventos', descricao: 'Criar eventos para seu grupo' },
                ]
            }
        },
        {
            nome: 'Tesoureiro',
            permissoes: {
                create: [
                    { nome: 'gerenciar_financeiro', descricao: 'Gerenciar finan√ßas da igreja' },
                    { nome: 'gerenciar_patrimonio', descricao: 'Gerenciar patrim√¥nio da igreja' },
                    { nome: 'visualizar_relatorios', descricao: 'Visualizar relat√≥rios financeiros' },
                ]
            }
        },
        {
            nome: 'Volunt√°rio',
            permissoes: {
                create: [
                    { nome: 'visualizar_agenda', descricao: 'Visualizar agenda de eventos' },
                    { nome: 'visualizar_mural', descricao: 'Visualizar mural da igreja' },
                ]
            }
        },
        {
            nome: 'Membro',
            permissoes: {
                create: [
                    { nome: 'visualizar_agenda', descricao: 'Visualizar agenda de eventos' },
                    { nome: 'visualizar_mural', descricao: 'Visualizar mural da igreja' },
                    { nome: 'editar_perfil', descricao: 'Editar pr√≥prio perfil' },
                ]
            }
        }
    ];

    const perfis: any[] = [];
    for (const perfilData of perfisData) {
        const perfil = await prisma.perfil.create({
            data: perfilData,
            include: { permissoes: true }
        });
        perfis.push(perfil);
    }

    return perfis;
}

async function createGrupos() {
    const gruposData = [
        {
            nome: 'C√©lula Esperan√ßa',
            categoria: 'C√©lula',
            endereco: 'Rua das Flores, 123 - Centro',
            lideres: JSON.stringify(['Jo√£o Silva', 'Maria Santos']),
            dataHoraReuniao: new Date('2024-01-15T19:30:00'),
            status: 'Ativo',
            observacoes: 'C√©lula focada em jovens e fam√≠lias'
        },
        {
            nome: 'Grupo de Ora√ß√£o',
            categoria: 'Minist√©rio',
            endereco: 'Igreja - Sala 2',
            lideres: JSON.stringify(['Ana Costa']),
            dataHoraReuniao: new Date('2024-01-10T18:00:00'),
            status: 'Ativo',
            observacoes: 'Reuni√£o de ora√ß√£o todas as quartas-feiras'
        },
        {
            nome: 'Minist√©rio de Louvor',
            categoria: 'Minist√©rio',
            endereco: 'Igreja - Santu√°rio',
            lideres: JSON.stringify(['Carlos Oliveira', 'Fernanda Lima']),
            dataHoraReuniao: new Date('2024-01-12T19:00:00'),
            status: 'Ativo',
            observacoes: 'Ensaios aos s√°bados'
        },
        {
            nome: 'C√©lula Vida Nova',
            categoria: 'C√©lula',
            endereco: 'Av. Principal, 456 - Jardim',
            lideres: JSON.stringify(['Pedro Almeida']),
            dataHoraReuniao: new Date('2024-01-14T20:00:00'),
            status: 'Ativo',
            observacoes: 'C√©lula para novos convertidos'
        },
        {
            nome: 'Minist√©rio Infantil',
            categoria: 'Minist√©rio',
            endereco: 'Igreja - Sala Infantil',
            lideres: JSON.stringify(['Lucia Ferreira', 'Roberto Silva']),
            dataHoraReuniao: new Date('2024-01-07T09:00:00'),
            status: 'Ativo',
            observacoes: 'Atividades para crian√ßas de 4 a 12 anos'
        }
    ];

    const grupos: any[] = [];
    for (const grupoData of gruposData) {
        const grupo = await prisma.grupo.create({
            data: grupoData
        });
        grupos.push(grupo);
    }

    return grupos;
}

async function createPessoas(grupos: any[]) {
    const pessoasData = [
        {
            nome: 'Jo√£o Silva',
            dataNascimento: new Date('1985-03-15'),
            genero: 'Masculino',
            estadoCivil: 'Casado',
            email: 'joao.silva@email.com',
            telefone: '(11) 99999-1111',
            endereco: 'Rua das Flores, 123',
            numero: '123',
            bairro: 'Centro',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[0].id,
            dataIngresso: new Date('2020-01-15'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Engenheiro',
                estadoCivil: 'Casado',
                conjuge: 'Maria Silva'
            }
        },
        {
            nome: 'Maria Santos',
            dataNascimento: new Date('1990-07-22'),
            genero: 'Feminino',
            estadoCivil: 'Solteira',
            email: 'maria.santos@email.com',
            telefone: '(11) 99999-2222',
            endereco: 'Av. Principal, 456',
            numero: '456',
            bairro: 'Jardim',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[0].id,
            dataIngresso: new Date('2019-05-10'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Professora',
                ministerio: 'Ensino'
            }
        },
        {
            nome: 'Ana Costa',
            dataNascimento: new Date('1975-11-08'),
            genero: 'Feminino',
            estadoCivil: 'Casada',
            email: 'ana.costa@email.com',
            telefone: '(11) 99999-3333',
            endereco: 'Rua da Paz, 789',
            numero: '789',
            bairro: 'Vila Nova',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[1].id,
            dataIngresso: new Date('2018-03-20'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Enfermeira',
                ministerio: 'Ora√ß√£o'
            }
        },
        {
            nome: 'Carlos Oliveira',
            dataNascimento: new Date('1988-09-12'),
            genero: 'Masculino',
            estadoCivil: 'Casado',
            email: 'carlos.oliveira@email.com',
            telefone: '(11) 99999-4444',
            endereco: 'Rua Harmonia, 321',
            numero: '321',
            bairro: 'Centro',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[2].id,
            dataIngresso: new Date('2017-08-15'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'M√∫sico',
                ministerio: 'Louvor',
                instrumento: 'Guitarra'
            }
        },
        {
            nome: 'Fernanda Lima',
            dataNascimento: new Date('1992-04-18'),
            genero: 'Feminino',
            estadoCivil: 'Solteira',
            email: 'fernanda.lima@email.com',
            telefone: '(11) 99999-5555',
            endereco: 'Av. Melodia, 654',
            numero: '654',
            bairro: 'Jardim',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[2].id,
            dataIngresso: new Date('2019-02-10'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Cantora',
                ministerio: 'Louvor',
                instrumento: 'Vocal'
            }
        },
        {
            nome: 'Pedro Almeida',
            dataNascimento: new Date('1980-12-03'),
            genero: 'Masculino',
            estadoCivil: 'Casado',
            email: 'pedro.almeida@email.com',
            telefone: '(11) 99999-6666',
            endereco: 'Rua Nova Vida, 987',
            numero: '987',
            bairro: 'Vila Esperan√ßa',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[3].id,
            dataIngresso: new Date('2016-11-25'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Pastor',
                ministerio: 'Evangelismo'
            }
        },
        {
            nome: 'Lucia Ferreira',
            dataNascimento: new Date('1983-06-14'),
            genero: 'Feminino',
            estadoCivil: 'Casada',
            email: 'lucia.ferreira@email.com',
            telefone: '(11) 99999-7777',
            endereco: 'Rua Alegria, 147',
            numero: '147',
            bairro: 'Centro',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[4].id,
            dataIngresso: new Date('2018-09-05'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Pedagoga',
                ministerio: 'Infantil'
            }
        },
        {
            nome: 'Roberto Silva',
            dataNascimento: new Date('1978-01-28'),
            genero: 'Masculino',
            estadoCivil: 'Casado',
            email: 'roberto.silva@email.com',
            telefone: '(11) 99999-8888',
            endereco: 'Av. Crian√ßa, 258',
            numero: '258',
            bairro: 'Jardim',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'L√≠der',
            grupoId: grupos[4].id,
            dataIngresso: new Date('2017-04-12'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Educador F√≠sico',
                ministerio: 'Infantil'
            }
        }
    ];

    // Adicionar alguns membros regulares
    const membrosRegulares = [
        {
            nome: 'Marcos Pereira',
            dataNascimento: new Date('1995-05-20'),
            genero: 'Masculino',
            estadoCivil: 'Solteiro',
            email: 'marcos.pereira@email.com',
            telefone: '(11) 99999-9999',
            endereco: 'Rua Juventude, 369',
            numero: '369',
            bairro: 'Vila Nova',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'Membro',
            grupoId: grupos[0].id,
            dataIngresso: new Date('2021-06-15'),
            batizado: false,
            camposPersonalizados: {
                profissao: 'Estudante',
                curso: 'Administra√ß√£o'
            }
        },
        {
            nome: 'Juliana Rodrigues',
            dataNascimento: new Date('1987-10-11'),
            genero: 'Feminino',
            estadoCivil: 'Casada',
            email: 'juliana.rodrigues@email.com',
            telefone: '(11) 99999-0000',
            endereco: 'Rua Fam√≠lia, 741',
            numero: '741',
            bairro: 'Centro',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            funcao: 'Membro',
            grupoId: grupos[1].id,
            dataIngresso: new Date('2020-08-30'),
            batizado: true,
            camposPersonalizados: {
                profissao: 'Contadora',
                ministerio: 'Administra√ß√£o'
            }
        }
    ];

    const todasPessoas = [...pessoasData, ...membrosRegulares];

    for (const pessoaData of todasPessoas) {
        await prisma.pessoa.create({
            data: pessoaData
        });
    }
}

async function createLancamentosFinanceiros() {
    const lancamentosData = [
        {
            tipo: 'Receita',
            valor: 2500.00,
            data: new Date('2024-01-07'),
            categoria: 'D√≠zimo',
            pessoaFornecedor: 'Jo√£o Silva',
            formaPagamento: 'PIX',
            observacoes: 'D√≠zimo mensal'
        },
        {
            tipo: 'Receita',
            valor: 800.00,
            data: new Date('2024-01-07'),
            categoria: 'Oferta',
            pessoaFornecedor: 'Maria Santos',
            formaPagamento: 'Dinheiro',
            observacoes: 'Oferta especial para miss√µes'
        },
        {
            tipo: 'Despesa',
            valor: 450.00,
            data: new Date('2024-01-05'),
            categoria: 'Energia El√©trica',
            pessoaFornecedor: 'Companhia El√©trica',
            formaPagamento: 'D√©bito Autom√°tico',
            observacoes: 'Conta de luz da igreja'
        },
        {
            tipo: 'Despesa',
            valor: 320.00,
            data: new Date('2024-01-03'),
            categoria: 'Material de Limpeza',
            pessoaFornecedor: 'Loja de Materiais',
            formaPagamento: 'Cart√£o de Cr√©dito',
            observacoes: 'Produtos para limpeza da igreja'
        },
        {
            tipo: 'Receita',
            valor: 1200.00,
            data: new Date('2024-01-14'),
            categoria: 'D√≠zimo',
            pessoaFornecedor: 'Ana Costa',
            formaPagamento: 'Transfer√™ncia',
            observacoes: 'D√≠zimo mensal'
        },
        {
            tipo: 'Despesa',
            valor: 180.00,
            data: new Date('2024-01-10'),
            categoria: 'Internet',
            pessoaFornecedor: 'Provedor Internet',
            formaPagamento: 'D√©bito Autom√°tico',
            observacoes: 'Internet da igreja'
        }
    ];

    for (const lancamentoData of lancamentosData) {
        await prisma.lancamentoFinanceiro.create({
            data: lancamentoData
        });
    }
}

async function createPatrimonio() {
    const patrimonioData = [
        {
            nome: 'Sistema de Som',
            categoria: 'Equipamento de √Åudio',
            localizacao: 'Santu√°rio Principal',
            valorEstimado: 15000.00,
            dataAquisicao: new Date('2022-03-15'),
            situacao: 'Bom',
            anotacoes: 'Mesa de som digital com 32 canais'
        },
        {
            nome: 'Projetor Multim√≠dia',
            categoria: 'Equipamento de V√≠deo',
            localizacao: 'Santu√°rio Principal',
            valorEstimado: 3500.00,
            dataAquisicao: new Date('2023-01-20'),
            situacao: 'Excelente',
            anotacoes: 'Projetor Full HD para apresenta√ß√µes'
        },
        {
            nome: 'Piano Digital',
            categoria: 'Instrumento Musical',
            localizacao: 'Santu√°rio Principal',
            valorEstimado: 8000.00,
            dataAquisicao: new Date('2021-11-10'),
            situacao: 'Bom',
            anotacoes: 'Piano digital 88 teclas'
        },
        {
            nome: 'Cadeiras do Santu√°rio',
            categoria: 'Mobili√°rio',
            localizacao: 'Santu√°rio Principal',
            valorEstimado: 12000.00,
            dataAquisicao: new Date('2020-08-05'),
            situacao: 'Bom',
            anotacoes: '200 cadeiras estofadas'
        },
        {
            nome: 'Ar Condicionado Central',
            categoria: 'Climatiza√ß√£o',
            localizacao: 'Santu√°rio Principal',
            valorEstimado: 25000.00,
            dataAquisicao: new Date('2022-06-30'),
            situacao: 'Excelente',
            anotacoes: 'Sistema central de 60.000 BTUs'
        }
    ];

    for (const patrimonioItem of patrimonioData) {
        await prisma.patrimonio.create({
            data: patrimonioItem
        });
    }
}

async function createEventos() {
    const eventosData = [
        {
            titulo: 'Culto Dominical',
            dataHora: new Date('2024-01-21T10:00:00'),
            recorrencia: 'Semanal',
            notificacoesAtivadas: true,
            descricao: 'Culto de adora√ß√£o e prega√ß√£o da palavra'
        },
        {
            titulo: 'Reuni√£o de Ora√ß√£o',
            dataHora: new Date('2024-01-17T19:30:00'),
            recorrencia: 'Semanal',
            notificacoesAtivadas: true,
            descricao: 'Reuni√£o de ora√ß√£o todas as quartas-feiras'
        },
        {
            titulo: 'Escola B√≠blica Dominical',
            dataHora: new Date('2024-01-21T09:00:00'),
            recorrencia: 'Semanal',
            notificacoesAtivadas: true,
            descricao: 'Estudo b√≠blico para todas as idades'
        },
        {
            titulo: 'Confer√™ncia de Jovens',
            dataHora: new Date('2024-02-15T19:00:00'),
            recorrencia: '√önico',
            notificacoesAtivadas: true,
            descricao: 'Confer√™ncia especial para jovens com palestrante convidado'
        },
        {
            titulo: 'Retiro Espiritual',
            dataHora: new Date('2024-03-08T08:00:00'),
            recorrencia: '√önico',
            notificacoesAtivadas: true,
            descricao: 'Retiro de fim de semana para renova√ß√£o espiritual'
        }
    ];

    for (const eventoData of eventosData) {
        await prisma.evento.create({
            data: eventoData
        });
    }
}

async function createMensagensMural() {
    const mensagensData = [
        {
            titulo: 'Bem-vindos √† nossa igreja!',
            mensagem: 'Sejam todos bem-vindos √† nossa comunidade de f√©. Que Deus aben√ßoe a todos!',
            visibilidade: 'Todos',
            gruposEspecificos: JSON.stringify([])
        },
        {
            titulo: 'Confer√™ncia de Jovens - Inscri√ß√µes Abertas',
            mensagem: 'As inscri√ß√µes para a Confer√™ncia de Jovens est√£o abertas! N√£o percam essa oportunidade de crescimento espiritual.',
            visibilidade: 'Grupos Espec√≠ficos',
            gruposEspecificos: JSON.stringify(['C√©lula Esperan√ßa', 'C√©lula Vida Nova'])
        },
        {
            titulo: 'Campanha de Arrecada√ß√£o',
            mensagem: 'Estamos arrecadando alimentos n√£o perec√≠veis para fam√≠lias carentes. Sua contribui√ß√£o faz a diferen√ßa!',
            visibilidade: 'Todos',
            gruposEspecificos: JSON.stringify([])
        },
        {
            titulo: 'Ensaio do Coral',
            mensagem: 'Lembrete: ensaio do coral hoje √†s 19h no santu√°rio. Presen√ßa obrigat√≥ria para todos os coralistas.',
            visibilidade: 'Grupos Espec√≠ficos',
            gruposEspecificos: JSON.stringify(['Minist√©rio de Louvor'])
        }
    ];

    for (const mensagemData of mensagensData) {
        await prisma.mensagemMural.create({
            data: mensagemData
        });
    }
}

main()
    .catch((e) => {
        console.error('‚ùå Erro durante o seed:', e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });